name: Create Claims for repository

on:
  workflow_dispatch:
    inputs:
      repository:
        description: "Name of repository"
        required: true
        type: string
      organisation:
        description: "Name of organisation"
        required: true
        type: string
      use-default:
        description: "Use GitHub default OIDC subject format (true/false)"
        required: false
        type: string
        default: "false"
      include-claim-keys:
        description: "Comma-separated custom claim keys (used when use-default=false)"
        required: false
        type: string
        default: "repo,repository_owner,context,actor_id,actor"
      gh-token: 
        description: "Person GH github token"
        required: true

jobs:
  acquire_claims:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python3 -m pip install --upgrade pip
          pip3 install --no-compile -r requirements.txt

      - name: Run Python Script
        shell: bash
        env:
          GITHUB_TOKEN: ${{ inputs.gh-token }}
          ORGANISATION: ${{ inputs.organisation }}
          REPOSITORY: ${{ inputs.repository }}
          USE_DEFAULT: ${{ inputs.use-default }}
          INCLUDE_CLAIM_KEYS: ${{ inputs.include-claim-keys }}
        run: |
          python3 claims.py
